<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Senarai Peserta MLBB - NADI Taman Sri Muda</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
  body {
    background-color: #0d0d0d;
    color: white;
    font-family: 'Poppins', sans-serif;
  }
  .spinner-border {
    width: 2rem;
    height: 2rem;
    color: #00ffff;
  }
  table {
    background-color: white;
    color: black;
    border-radius: 10px;
    overflow: hidden;
  }
  th {
    background-color: #0d6efd;
    color: white;
  }
  #refreshBtn {
    background-color: #00ffff;
    color: black;
    font-weight: bold;
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    margin-bottom: 15px;
    transition: all 0.2s ease;
  }
  #refreshBtn:hover {
    background-color: #04c7c7;
  }
</style>
</head>

<body class="p-4">

<div class="container text-center">
  <h2 class="mb-3 text-uppercase">Senarai Peserta MLBB - NADI Taman Sri Muda</h2>

  <!-- Butang refresh -->
  <button id="refreshBtn">ðŸ”„ Refresh Senarai</button>

  <!-- Loading Spinner -->
  <div id="loading" class="my-3" style="display:none;">
    <div class="spinner-border" role="status"></div>
    <p class="mt-2">Memuatkan data peserta...</p>
  </div>

  <!-- Jumlah peserta -->
  <p id="participant_count" class="font-weight-bold"></p>

  <!-- Tarikh & masa update terakhir -->
  <p id="last_updated" class="text-info"></p>

  <!-- Tempat paparan table -->
  <div id="students_list"></div>
</div>

<script>
// Link CSV dari Google Sheets
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRqId3-gIXvIgl8qq_tA9LbGjRdwQs3kHbjoBAvwB4iY781AUMWpWv37deHOKbnXGMs1SUCWgL_yvEY/pub?output=csv";

// Fungsi utama untuk muat dan paparkan data
function loadStudents() {
  $('#loading').show();
  $('#students_list').hide();

  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      const data = results.data;

      if (data.length === 0) {
        $('#participant_count').text('Tiada peserta dijumpai.');
        $('#students_list').html('');
        $('#loading').hide();
        return;
      }

      // Bilangan peserta
      $('#participant_count').text('Jumlah peserta: ' + data.length);

      // Tarikh dan masa terakhir update
      const now = new Date();
      const timeString = now.toLocaleTimeString('ms-MY', { hour12: false });
      const dateString = now.toLocaleDateString('ms-MY');
      $('#last_updated').text('Dikemas kini pada: ' + dateString + ' ' + timeString);

      // Bina table
      let html = '<table class="table table-bordered table-striped text-center">';
      html += '<thead><tr>';
      Object.keys(data[0]).forEach(h => html += '<th>'+h+'</th>');
      html += '</tr></thead><tbody>';

      data.forEach(row => {
        html += '<tr>';
        Object.values(row).forEach(cell => html += '<td>'+cell+'</td>');
        html += '</tr>';
      });

      html += '</tbody></table>';
      $('#students_list').html(html);

      $('#loading').hide();
      $('#students_list').show();
    },
    error: function(err) {
      console.error(err);
      $('#participant_count').text('Gagal memuatkan data. Semak link CSV.');
      $('#students_list').html('');
      $('#loading').hide();
    }
  });
}

// Bila tekan butang refresh
$('#refreshBtn').on('click', function(){
  loadStudents();
});

// Muat data kali pertama bila laman dibuka
$(document).ready(function(){
  loadStudents();
});
</script>

</body>
</html>
