<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Senarai Peserta MLBB - NADI Taman Sri Muda</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
  .container, .container-sm {
    margin:0px;
  }
  .search-bar {
    margin-bottom: 15px;
  }
</style>
</head>
<body>

<div class="container" style="margin-left:-10px;">

  <h4 class="mt-2 mb-3 font-weight-bold text-center">Senarai Peserta MLBB - NADI Taman Sri Muda</h4>

  <!-- Search bar -->
  <div class="search-bar row">
    <div class="col-md-4 col-sm-12 mb-2">
      <input type="text" id="searchName" class="form-control" placeholder="Cari Nama">
    </div>
    <div class="col-md-4 col-sm-12 mb-2">
      <input type="text" id="searchIC" class="form-control" placeholder="Cari IC Number">
    </div>
    <div class="col-md-4 col-sm-12 mb-2">
      <input type="text" id="searchTeam" class="form-control" placeholder="Cari Team">
    </div>
  </div>

  <!-- Tempat untuk paparkan jumlah peserta -->
  <p id="participant_count" class="font-weight-bold">Memuatkan data...</p>

  <div id="students_list"></div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRqId3-gIXvIgl8qq_tA9LbGjRdwQs3kHbjoBAvwB4iY781AUMWpWv37deHOKbnXGMs1SUCWgL_yvEY/pub?output=csv";

let allData = [];

// Fungsi untuk paparkan data ke dalam jadual
function displayTable(data) {
  if (data.length === 0) {
    $('#students_list').html('<p>Tiada peserta dijumpai.</p>');
    $('#participant_count').text('Jumlah peserta: 0');
    return;
  }

  $('#participant_count').text('Jumlah peserta: ' + data.length);

  let html = '<table class="table table-striped table-bordered">';
  html += '<thead><tr>';
  Object.keys(data[0]).forEach(h => html += '<th>'+h+'</th>');
  html += '</tr></thead><tbody>';

  data.forEach(row => {
    html += '<tr>';
    Object.values(row).forEach(cell => html += '<td>'+cell+'</td>');
    html += '</tr>';
  });

  html += '</tbody></table>';
  $('#students_list').html(html);
}

// Fungsi untuk muat CSV
function loadStudents() {
  Papa.parse(CSV_URL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      allData = results.data;
      displayTable(allData);
    },
    error: function(err){
      console.error(err);
      $('#participant_count').text('Gagal memuatkan data. Periksa link CSV anda.');
      $('#students_list').html('');
    }
  });
}

// Fungsi carian
function filterTable() {
  const nameVal = $('#searchName').val().toLowerCase();
  const icVal = $('#searchIC').val().toLowerCase();
  const teamVal = $('#searchTeam').val().toLowerCase();

  const filtered = allData.filter(row => {
    const nameMatch = row['Name'] ? row['Name'].toLowerCase().includes(nameVal) : false;
    const icMatch = row['IC Number'] ? row['IC Number'].toLowerCase().includes(icVal) : false;
    const teamMatch = row['Team'] ? row['Team'].toLowerCase().includes(teamVal) : false;
    return nameMatch && icMatch && teamMatch;
  });

  displayTable(filtered);
}

$(document).ready(function(){
  loadStudents();

  // Bila user taip dalam search
  $('#searchName, #searchIC, #searchTeam').on('input', filterTable);
});
</script>

</body>
</html>
